<html ng-app="wpReader">
	<head>
	<meta charset="utf8">
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<style>
		    a {
		    	color: black;
		    }
			h1,h2,h3,h4,h5,h6 {
				line-height: 1.36em;
				font-weight: 800;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="col-md-12" ng-controller="FirstCtrl">
				<div class="row">
						<div class="media col-md-8" ng-repeat="post in posts" style="margin-top: 50px;">
						  <div class="media-left">
						    <a href="#">
						    	<div style="width: 128px; height: 128px; background-image: url('{{post._embedded['wp:featuredmedia'][0].source_url}}'); background-size: cover; background-position: center"></div>
						    </a>
						  </div>
						  <div class="media-body">
							<a ng-href="{{post.link}}"><h4  class="media-heading" ng-bind-html="post.title.rendered"></h4></a>
							<p><small><strong>{{post.midia}}</strong> | <span ng-bind-html="post.date | date"></span</small></p>
							<p ng-bind-html="post.excerpt.rendered"></p>
						  </div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script
		  src="http://code.jquery.com/jquery-3.2.1.min.js"
		  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
		  crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.5/angular-resource.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.5/angular-sanitize.min.js"></script>
		<script>
			'use strict';

			// Define the `wpReader` module
			angular.module('wpReader', ['ngSanitize','ngResource'])

			.service('wp', function ($resource, $q) {
				var baseUrl = 'http://vaidape.com.br/wp-json/wp/v2/';


				var sites = [
					{
						name: 'Vaidapé',
						apiUrl: 'http://vaidape.com.br/wp-json/wp/v2/'
					},
					{
						name: 'Ponte Jornalismo',
						apiUrl: 'https://ponte.org/wp-json/wp/v2/'
					},
					{
						name: 'Justificando',
						apiUrl: 'http://justificando.cartacapital.com.br/wp-json/wp/v2/'
					},
					{
						name: 'Geledés',
						apiUrl: 'https://www.geledes.org.br/wp-json/wp/v2/'
					},
				]

				var wp = []

				for (var i =  sites.length - 1; i >= 0; i--) {
					var posts = $resource( sites[i].apiUrl + "posts?search='bolsonaro'").query()

					$q.all([
					    posts.$promise
					]).then( function (data) { 
						var psts = data[0];
						console.log(psts[0])
						for (var i = psts.length - 1; i >= 0; i--) {
							psts[i].midia = psts[i].link.split('/').slice(2,3).join('/')
						};
						wp.push(psts[0])
						// Array.prototype.push.apply(wp, psts);
						  wp.sort(function(a, b){
						    var keyA = new Date(a.date),
						        keyB = new Date(b.date);
						    // Compare the 2 dates
						    if(keyA < keyB) return 1;
						    if(keyA > keyB) return -1;
						    return 0;
						});
					});
							 
				};


				return wp

			})

			.controller('FirstCtrl', ['$scope', 'wp', function($scope, wp) {
			  $scope.posts = wp

			  console.log($scope.posts)
			}]);
		</script>
	</body>
</html>